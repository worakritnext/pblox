import{S as t,i as e,s,e as o,t as n,k as i,c as a,a as l,g as c,d as r,n as d,b as u,f as v,D as p,E as f,F as h,P as g,G as m,Q as y,H as x,A as E}from"../chunks/vendor-ec965bd2.js";import{u as I}from"../chunks/user-96e9540c.js";import{g as b}from"../chunks/navigation-2ffed81e.js";import"../chunks/singletons-12a22614.js";function j(t){let e,s,x,E,I,b,j,w,k,T,A,S,P,B,D,L,N,O,U,V,$,z,C,F;return{c(){e=o("form"),s=o("div"),x=o("label"),E=n("ชื่อเรื่อง"),I=i(),b=o("input"),j=i(),w=o("div"),k=o("label"),T=n("อธิบาย"),A=i(),S=o("input"),P=i(),B=o("div"),D=o("label"),L=n("เนื้อหา"),N=i(),O=o("textarea"),U=i(),V=o("div"),$=o("button"),z=n("บันทึก"),this.h()},l(t){e=a(t,"FORM",{class:!0});var o=l(e);s=a(o,"DIV",{class:!0});var n=l(s);x=a(n,"LABEL",{for:!0,class:!0});var i=l(x);E=c(i,"ชื่อเรื่อง"),i.forEach(r),I=d(n),b=a(n,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),n.forEach(r),j=d(o),w=a(o,"DIV",{class:!0});var u=l(w);k=a(u,"LABEL",{for:!0,class:!0});var v=l(k);T=c(v,"อธิบาย"),v.forEach(r),A=d(u),S=a(u,"INPUT",{type:!0,placeholder:!0,id:!0,class:!0}),u.forEach(r),P=d(o),B=a(o,"DIV",{class:!0});var p=l(B);D=a(p,"LABEL",{for:!0,class:!0});var f=l(D);L=c(f,"เนื้อหา"),f.forEach(r),N=d(p),O=a(p,"TEXTAREA",{rows:!0,placeholder:!0,id:!0,class:!0}),l(O).forEach(r),p.forEach(r),U=d(o),V=a(o,"DIV",{class:!0});var h=l(V);$=a(h,"BUTTON",{class:!0,type:!0});var g=l($);z=c(g,"บันทึก"),g.forEach(r),h.forEach(r),o.forEach(r),this.h()},h(){u(x,"for","title"),u(x,"class","svelte-1gr50x2"),u(b,"type","text"),u(b,"placeholder","พิมพ์ชื่อเรื่อง"),u(b,"id","title"),u(b,"class","svelte-1gr50x2"),u(s,"class","my-1"),u(k,"for","description"),u(k,"class","svelte-1gr50x2"),u(S,"type","text"),u(S,"placeholder","คำอธิบายโดยย่อ"),u(S,"id","description"),u(S,"class","svelte-1gr50x2"),u(w,"class","my-1"),u(D,"for","title"),u(D,"class","svelte-1gr50x2"),u(O,"rows",5),u(O,"placeholder","เนื้อรายละเอียดที่แสดง"),u(O,"id","content"),u(O,"class","svelte-1gr50x2"),u(B,"class","my-1"),u($,"class","submit svelte-1gr50x2"),u($,"type","submit"),u(V,"class","my-2"),u(e,"class","my-4 mx-auto container p-4")},m(o,n){v(o,e,n),p(e,s),p(s,x),p(x,E),p(s,I),p(s,b),f(b,t[0]),p(e,j),p(e,w),p(w,k),p(k,T),p(w,A),p(w,S),f(S,t[1]),p(e,P),p(e,B),p(B,D),p(D,L),p(B,N),p(B,O),f(O,t[2]),p(e,U),p(e,V),p(V,$),p($,z),C||(F=[h(b,"input",t[5]),h(S,"input",t[6]),h(O,"input",t[7]),h(e,"submit",g(t[3]))],C=!0)},p(t,[e]){1&e&&b.value!==t[0]&&f(b,t[0]),2&e&&S.value!==t[1]&&f(S,t[1]),4&e&&f(O,t[2])},i:m,o:m,d(t){t&&r(e),C=!1,y(F)}}}var w=function(t,e,s,o){return new(s||(s=Promise))((function(n,i){function a(t){try{c(o.next(t))}catch(e){i(e)}}function l(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,l)}c((o=o.apply(t,e||[])).next())}))};const k=({fetch:t,page:{query:e}})=>w(void 0,void 0,void 0,(function*(){const s=e.get("edit");if(s){const e=yield t("http://localhost:1337/posts/"+s);if(404===e.status){return{status:404,error:new Error(`The post with ID ${s} was not found`)}}{const t=yield e.json();return{props:{editId:s,title:t.title,content:t.content,description:t.description}}}}return{props:{}}}));function T(t,e,s){let o;x(t,I,(t=>s(8,o=t)));var n=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,i){function a(t){try{c(o.next(t))}catch(e){i(e)}}function l(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,l)}c((o=o.apply(t,e||[])).next())}))};let{editId:i}=e,{title:a=""}=e,{description:l=""}=e,{content:c=""}=e;return E((()=>{o||b("/login")})),t.$$set=t=>{"editId"in t&&s(4,i=t.editId),"title"in t&&s(0,a=t.title),"description"in t&&s(1,l=t.description),"content"in t&&s(2,c=t.content)},[a,l,c,function(){var t,e,s,o;return n(this,void 0,void 0,(function*(){if(!localStorage.getItem("token"))return void b("/login");if(i)return void function(){var t,e,s,o;n(this,void 0,void 0,(function*(){if(!localStorage.getItem("token"))return void b("/login");const n=yield fetch("http://localhost:1337/posts/"+i,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({title:a,description:l,content:c})});if(n.ok){const t=yield n.json();b("/blog/"+t.id)}else{const i=yield n.json();(null===(o=null===(s=null===(e=null===(t=null==i?void 0:i.message)||void 0===t?void 0:t[0])||void 0===e?void 0:e.messages)||void 0===s?void 0:s[0])||void 0===o?void 0:o.message)&&alert(i.message[0].messages[0].message)}}))}();const r=yield fetch("http://localhost:1337/posts",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({title:a,description:l,content:c})});if(r.ok){const t=yield r.json();b("/blog/"+t.id)}else{const n=yield r.json();(null===(o=null===(s=null===(e=null===(t=null==n?void 0:n.message)||void 0===t?void 0:t[0])||void 0===e?void 0:e.messages)||void 0===s?void 0:s[0])||void 0===o?void 0:o.message)&&alert(n.message[0].messages[0].message)}}))},i,function(){a=this.value,s(0,a)},function(){l=this.value,s(1,l)},function(){c=this.value,s(2,c)}]}class A extends t{constructor(t){super(),e(this,t,T,j,s,{editId:4,title:0,description:1,content:2})}}export{A as default,k as load};
